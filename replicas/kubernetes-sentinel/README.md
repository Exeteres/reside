# Кубовая Реплика

[Назад к списку реплик](/replicas/README.md)

<table>
<tr>
<td valign="top">

Эта реплика появляется сразу после [Первоначальной Реплики](../seed/README.md) и остается в кластере на протяжении всего его жизненного цикла.
Она отслеживает желания других реплик относительно ресурсов Kubernetes и приводит текущее состояние кластера в соответствие с этими желаниями.
Она также собирает информацию о состоянии ресурсов и предоставляет её другим репликам в реальном времени.

</td>
<td>

<img width="300" src="REPLICA.png" alt="Kubernetes Sentinel Replica"/>

</td>
</tr>
</table>

## API Реплики

API данной реплики представляет собой набор коллекций объектов, т.н. `ManagedObject`, каждый из которых соответствует ресурсу Kubernetes.

Каждый `ManagedObject` содержит:

- **name**: Имя ресурса Kubernetes
- **status**: Статус синхронизации ресурса (`requested`, `updated`, `error`)
- **manifest**: Желаемый манифест ресурса в виде объекта 
- **live**: Наблюдаемый манифест ресурса

Каждая коллекция `ManagedObject` соответствует определенному типу ресурса Kubernetes.

Типичный флоу работы с этой репликой со стороны потребителя:

1. Создать/обновить `ManagedObject` с желаемым манифестом ресурса;
2. Перевести его статус в `requested`, чтобы стриггерить Кубовую Реплику;
3. (опционально) Дождаться обновления статуса до `updated` или `error`;
4. Читать поле `live` для получения текущего состояния ресурса.

Поскольку сами коллекции представляют собой объекты Jazz и хранятся на сервере синхронизации, отказ Кубовой Реплики не приводит к ошибкам у потребителей, а также потери желаемых манифестов. Просто они не будут применены до восстановления реплики, а текущее состояние ресурсов не будет обновляться.

Самым очевидным потребителем этой реплики является [Альфа-Реплика](/replicas/alpha/README.md), которая использует её для развертывания других реплик.
